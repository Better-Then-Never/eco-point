import{e as H,l as h,c as g,a as t,A as O,t as s,x as S,I as tt,o as u,J as et,m as st,r as k,K as C,L as P,M as Y,n as q,N as at,O as ot,q as N,P as rt,j as lt,f as nt,k as it,y as o,b as d,F as G,v as T}from"#entry";import{u as dt}from"./slNtMkyD.js";import{C as ct,A}from"./BouLmadH.js";import{c as j}from"./B-3r2T44.js";import{T as gt,G as ut}from"./BFlP-fUc.js";import{L as V}from"./DcALyCpx.js";import{U as ht}from"./Cl_slRIs.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=j("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=j("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=j("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),xt={class:"flex items-center justify-between mb-2"},bt={class:"text-gray-700 dark:text-gray-300 font-medium leading-tight"},ft={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},yt={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mt-2 leading-tight"},_t=H({__name:"ProgressBar",props:{label:{},value:{},max:{},unit:{},subtitle:{},color:{}},setup(w){const e=w,r=h(()=>Math.min(e.value/e.max*100,100)),a=h(()=>{const l=e.unit?`${e.value} ${e.unit}`:e.value,x=e.unit?`${e.max} ${e.unit}`:e.max;return`${l} / ${x}`}),m=h(()=>{switch(e.color){case"green":return"bg-gradient-to-r from-green-600 to-green-500";case"blue":return"bg-gradient-to-r from-blue-600 to-blue-500";case"gray":default:return"bg-gradient-to-r from-gray-800 to-gray-900 dark:from-gray-600 dark:to-gray-700"}}),n=h(()=>{switch(e.color){case"green":return"text-green-600 dark:text-green-400";case"blue":return"text-blue-600 dark:text-blue-400";case"gray":default:return"text-gray-700 dark:text-gray-300"}});return(l,x)=>(u(),g("div",null,[t("div",xt,[t("p",bt,s(w.label),1),t("p",{class:S(["font-bold leading-tight",n.value])},s(a.value),3)]),t("div",ft,[t("div",{class:S(["h-3 rounded-full transition-all duration-500",m.value]),style:tt({width:`${r.value}%`})},null,6)]),w.subtitle?(u(),g("p",yt,s(w.subtitle),1)):O("",!0)]))}}),F=Object.assign(_t,{__name:"ProgressBar"}),kt=et("statistics",()=>{const e=st().$firebaseDb,r=k(null),a=k(0),m=k([]),n=k([]),l=k([]),x=k(!1),f=k(null),Q=h(()=>r.value?.pointsEarned||0),J=h(()=>r.value?.pointsBalance||0),K=h(()=>r.value?.totalSessions||0),W=h(()=>r.value?.totalSessions||0),R=h(()=>r.value?.currentMonthSessions||0),X=h(()=>r.value?.achievements?.length||0),Z=h(()=>r.value?.rewards?.length||0),U=h(()=>{const i=r.value?.totalSessions||0;return Math.round(i*.27*10)/10}),I=h(()=>Math.round(U.value/21)),M=async i=>{if(!i){f.value="User ID is required";return}x.value=!0,f.value=null;try{const p=await C(P(e,"users",i));p.exists()?r.value=p.data():(f.value="User not found",r.value=null)}catch(p){console.error("Error fetching user stats:",p),f.value=p.message}finally{x.value=!1}},D=async i=>{if(i){x.value=!0,f.value=null;try{const p=Y(q(e,"users"),at("pointsEarned","desc"),ot(20)),c=await N(p),v=[];let y=0,b=!1;if(c.docs.forEach((_,$)=>{const E=_.data(),B=$+1,z=_.id===i;z&&(y=B,b=!0),v.push({rank:B,name:z?"You":E.name||E.username||"Anonymous",points:E.pointsEarned||0,isYou:z})}),!b&&r.value){const _=Y(q(e,"users"),rt("pointsEarned",">",r.value.pointsEarned));y=(await N(_)).size+1,v.push({rank:y,name:"You",points:r.value.pointsEarned,isYou:!0})}if(a.value=y,m.value=v.slice(0,10),!b){const _=v.find($=>$.isYou);_&&m.value.push(_)}}catch(p){console.error("Error fetching global ranking:",p),f.value=p.message}finally{x.value=!1}}},L=async()=>{if(!r.value?.achievements||r.value.achievements.length===0){l.value=[];return}try{const i=r.value.achievements.map(async c=>{let v=c;if(c&&typeof c=="object"&&c.path){const b=c.path.split("/");v=b[b.length-1]}else if(typeof c=="string"&&c.includes("/")){const b=c.split("/");v=b[b.length-1]}console.log("Fetching achievement:",v,"from ref:",c);const y=await C(P(e,"achievements",v));return y.exists()?(console.log("Achievement found:",y.data()),y.data()):(console.log("Achievement not found:",v),null)}),p=await Promise.all(i);l.value=p.filter(c=>c!==null),console.log("Total achievements loaded:",l.value.length)}catch(i){console.error("Error fetching achievements:",i),l.value=[]}};return{userStats:r,globalRank:a,topUsers:m,monthlyActivity:n,userAchievements:l,loading:x,error:f,totalPoints:Q,pointsBalance:J,itemsRecycled:K,totalSessions:W,currentMonthSessions:R,achievements:X,rewards:Z,co2Saved:U,treesEquivalent:I,fetchUserStats:M,fetchGlobalRanking:D,fetchUserAchievements:L,loadUserData:async i=>{await M(i),await D(i),await L()},reset:()=>{r.value=null,a.value=0,m.value=[],n.value=[],l.value=[],x.value=!1,f.value=null}}}),wt={class:"min-h-screen bg-gradient-to-b from-white to-green-50 dark:from-gray-900 dark:to-gray-800 transition-colors duration-300"},$t={key:0,class:"container mx-auto px-4 sm:px-6 lg:px-8 py-12"},St={class:"flex flex-col items-center justify-center min-h-[50vh]"},Et={class:"mt-4 text-gray-600 dark:text-gray-400"},zt={key:1,class:"container mx-auto px-4 sm:px-6 lg:px-8 py-12"},At={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 text-center"},jt={class:"text-red-600 dark:text-red-400"},Ut={key:2,class:"container mx-auto px-4 sm:px-6 lg:px-8 py-12"},Mt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12"},Dt={class:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white rounded-2xl shadow-lg p-6"},Lt={class:"flex items-center justify-between"},Bt={class:"text-yellow-100 text-sm mb-2 leading-tight"},Ct={class:"text-4xl font-bold leading-tight"},Pt={class:"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-2xl shadow-lg p-6"},Yt={class:"flex items-center justify-between"},qt={class:"text-green-100 text-sm mb-2 leading-tight"},Nt={class:"text-4xl font-bold leading-tight"},Gt={class:"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-2xl shadow-lg p-6"},Tt={class:"flex items-center justify-between"},Vt={class:"text-purple-100 text-sm mb-2 leading-tight"},Ft={class:"text-4xl font-bold leading-tight"},Ht={class:"bg-gradient-to-br from-indigo-500 to-indigo-600 text-white rounded-2xl shadow-lg p-6"},Ot={class:"flex items-center justify-between"},Qt={class:"text-indigo-100 text-sm mb-2 leading-tight"},Jt={class:"text-4xl font-bold leading-tight"},Kt={class:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl shadow-lg p-6"},Wt={class:"flex items-center justify-between"},Rt={class:"text-blue-100 text-sm mb-2 leading-tight"},Xt={class:"text-4xl font-bold leading-tight"},Zt={class:"bg-gradient-to-br from-teal-500 to-teal-600 text-white rounded-2xl shadow-lg p-6"},It={class:"flex items-center justify-between"},te={class:"text-teal-100 text-sm mb-2 leading-tight"},ee={class:"text-4xl font-bold leading-tight"},se={class:"bg-gradient-to-br from-pink-500 to-pink-600 text-white rounded-2xl shadow-lg p-6"},ae={class:"flex items-center justify-between"},oe={class:"text-pink-100 text-sm mb-2 leading-tight"},re={class:"text-4xl font-bold leading-tight"},le={class:"bg-gradient-to-br from-amber-500 to-amber-600 text-white rounded-2xl shadow-lg p-6"},ne={class:"flex items-center justify-between"},ie={class:"text-amber-100 text-sm mb-2 leading-tight"},de={class:"text-4xl font-bold leading-tight"},ce={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ge={class:"lg:col-span-2 space-y-8"},ue={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border-2 border-gray-100 dark:border-gray-700 transition-colors"},he={class:"flex items-center gap-2 mb-6"},pe={class:"text-2xl font-bold text-gray-900 dark:text-white leading-tight"},ve={class:"space-y-6"},me={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border-2 border-gray-100 dark:border-gray-700 transition-colors"},xe={class:"flex items-center gap-2 mb-6"},be={class:"text-2xl font-bold text-gray-900 dark:text-white leading-tight"},fe={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},ye={key:1,class:"space-y-4"},_e={class:"flex items-start gap-3"},ke={class:"bg-pink-500 text-white rounded-lg p-2 flex-shrink-0"},we={class:"flex-1"},$e={class:"font-bold text-gray-900 dark:text-white mb-1 leading-tight"},Se={class:"text-sm text-gray-600 dark:text-gray-400 leading-tight"},Ee={class:"lg:col-span-1"},ze={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border-2 border-gray-100 dark:border-gray-700 transition-colors sticky top-8"},Ae={class:"flex items-center gap-2 mb-6"},je={class:"text-2xl font-bold text-gray-900 dark:text-white leading-tight"},Ue={class:"space-y-3"},Me={class:"flex items-center gap-3"},De={class:"font-semibold text-gray-900 dark:text-white leading-tight"},Le={class:"text-sm text-gray-600 dark:text-gray-400 leading-tight"},Be={key:0,class:"bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full"},He=H({__name:"profile",setup(w){lt();const e=kt(),{user:r}=dt();return nt(async()=>{r.value?.uid&&await e.loadUserData(r.value.uid)}),it(r,async a=>{a?.uid?await e.loadUserData(a.uid):e.reset()}),(a,m)=>(u(),g("div",wt,[o(e).loading?(u(),g("div",$t,[t("div",St,[m[0]||(m[0]=t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-green-600 dark:border-green-400"},null,-1)),t("p",Et,s(a.$t("profile.loading")||"Loading..."),1)])])):o(e).error?(u(),g("div",zt,[t("div",At,[t("p",jt,s(o(e).error),1)])])):(u(),g("div",Ut,[t("div",Mt,[t("div",Dt,[t("div",Lt,[t("div",null,[t("p",Bt,s(a.$t("profile.pointsEarned")),1),t("p",Ct,s(o(e).totalPoints.toLocaleString()),1)]),d(o(ct),{size:48,class:"text-white opacity-80"})])]),t("div",Pt,[t("div",Yt,[t("div",null,[t("p",qt,s(a.$t("profile.pointsBalance")),1),t("p",Nt,s(o(e).pointsBalance.toLocaleString()),1)]),d(o(mt),{size:48,class:"text-white opacity-80"})])]),t("div",Gt,[t("div",Tt,[t("div",null,[t("p",Vt,s(a.$t("profile.totalSessions")),1),t("p",Ft,s(o(e).totalSessions),1)]),d(o(pt),{size:48,class:"text-white opacity-80"})])]),t("div",Ht,[t("div",Ot,[t("div",null,[t("p",Qt,s(a.$t("profile.monthSessions")),1),t("p",Jt,s(o(e).currentMonthSessions),1)]),d(o(vt),{size:48,class:"text-white opacity-80"})])]),t("div",Kt,[t("div",Wt,[t("div",null,[t("p",Rt,s(a.$t("profile.globalRank")),1),t("p",Xt,"#"+s(o(e).globalRank||"-"),1)]),d(o(gt),{size:48,class:"text-white opacity-80"})])]),t("div",Zt,[t("div",It,[t("div",null,[t("p",te,s(a.$t("profile.co2Saved")),1),t("p",ee,s(o(e).co2Saved)+" kg",1)]),d(o(V),{size:48,class:"text-white opacity-80"})])]),t("div",se,[t("div",ae,[t("div",null,[t("p",oe,s(a.$t("profile.achievements")),1),t("p",re,s(o(e).achievements),1)]),d(o(A),{size:48,class:"text-white opacity-80"})])]),t("div",le,[t("div",ne,[t("div",null,[t("p",ie,s(a.$t("profile.rewards")),1),t("p",de,s(o(e).rewards),1)]),d(o(ut),{size:48,class:"text-white opacity-80"})])])]),t("div",ce,[t("div",ge,[t("div",ue,[t("div",he,[d(o(V),{size:24,class:"text-green-600 dark:text-green-400"}),t("h2",pe,s(a.$t("profile.environmentalImpact")),1)]),t("div",ve,[d(F,{label:a.$t("profile.co2EmissionsSaved"),value:o(e).co2Saved,max:50,unit:"kg",subtitle:a.$t("profile.treesEquivalent",{count:o(e).treesEquivalent}),color:"green"},null,8,["label","value","subtitle"]),d(F,{label:a.$t("profile.recyclingGoal"),value:o(e).itemsRecycled,max:200,subtitle:a.$t("profile.keepGoing"),color:"blue"},null,8,["label","value","subtitle"])])]),t("div",me,[t("div",xe,[d(o(A),{size:24,class:"text-pink-600 dark:text-pink-400"}),t("h2",be,s(a.$t("profile.achievementsTitle")),1)]),o(e).userAchievements.length===0?(u(),g("div",fe,s(a.$t("profile.noAchievements")),1)):(u(),g("div",ye,[(u(!0),g(G,null,T(o(e).userAchievements,(n,l)=>(u(),g("div",{key:l,class:"bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 border border-pink-200 dark:border-pink-800 rounded-xl p-4 transition-all hover:shadow-md"},[t("div",_e,[t("div",ke,[d(o(A),{size:20})]),t("div",we,[t("h3",$e,s(a.$i18n.locale==="pl"?n.namePL:n.nameEN),1),t("p",Se,s(a.$i18n.locale==="pl"?n.descriptionPL:n.descriptionEN),1)])])]))),128))]))])]),t("div",Ee,[t("div",ze,[t("div",Ae,[d(o(ht),{size:24,class:"text-purple-600 dark:text-purple-400"}),t("h2",je,s(a.$t("profile.ecoRanking")),1)]),t("div",Ue,[(u(!0),g(G,null,T(o(e).topUsers,(n,l)=>(u(),g("div",{key:l,class:S(["flex items-center justify-between p-4 rounded-xl transition-all",n.isYou?"bg-gradient-to-r from-green-100 to-teal-100 dark:from-green-900/30 dark:to-teal-900/30 border-2 border-green-400 dark:border-green-600":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"])},[t("div",Me,[t("div",{class:S(["flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm",l===0?"bg-yellow-400 text-yellow-900":l===1?"bg-gray-300 text-gray-700":l===2?"bg-orange-300 text-orange-900":"bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300"])},s(n.isYou?"#"+n.rank:l<3?["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][l]:"#"+n.rank),3),t("div",null,[t("p",De,s(n.name),1),t("p",Le,s(n.points.toLocaleString())+" "+s(a.$t("profile.pts")),1)])]),n.isYou?(u(),g("div",Be,s(a.$t("profile.you")),1)):O("",!0)],2))),128))])])])])]))]))}});export{He as default};
